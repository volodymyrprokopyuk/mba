#!/usr/bin/env runghc
import Development.Shake
import Development.Shake.Command
import Development.Shake.FilePath
import Development.Shake.Util

main :: IO ()
main = shakeArgs shakeOptions { shakeFiles = ".build/" } $ do
  want [ "pdf/plan_de_empresa.pdf" ]

  "pdf/*.pdf" %> \ target -> do
    putNormal "** compiling PDFs"
    let source = ("tex" </>) . (-<.> "tex") . takeFileName $ target
    need [ source, "tex/layout.tex" ]
    cmd "bash -c" [ "cd pdf && context --path=../tex " ++ ".." </> source ]

  "upload" ~> do
    cmd "bash -c" [ "cp pdf/plan_de_empresa.pdf ~/Dropbox/git-newmba" ]

  "clean" ~> do
    putNormal "** removing PDFs"
    removeFilesAfter "pdf" [ "*" ]
